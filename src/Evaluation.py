# -*- coding: utf-8 -*-
"""Evaluation

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IZY1N5nHsN0m6OF_FXdLkRVNDrvYhRAa
"""

y_pred_lr = best_model.predict(X_test)
y_proba_lr = best_model.predict_proba(X_test)[:,1]

print(classification_report(y_test, y_pred_lr))
print("ROC AUC:", roc_auc_score(y_test, y_proba_lr))

y_pred_rf = model_rf.predict(X_test_processed)
y_proba_rf = rf.predict_proba(X_test_processed)[:,1]

print(classification_report(y_test, y_pred_rf))
print("ROC-AUC: ", roc_auc_score(y_test, y_proba_rf))

# Confusion Matrix

conf_matrix = confusion_matrix(y_test, y_pred_lr)
plt.figure(figsize=(5,5))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues')
plt.title("Confusion Matrix")
plt.xlabel("Predicted")
plt.ylabel("Actual")

# Ambil feature importance
importances = rf.feature_importances_

# Ambil nama fitur setelah preprocessing
feature_names = preprocessor.get_feature_names_out()

# Buat dataframe
feat_imp = pd.DataFrame({
    'feature': feature_names,
    'importance': importances
}).sort_values(by='importance', ascending=False)

# Ambil top 15 fitur terpenting
top_features = feat_imp.head(15)

# Plot
plt.figure(figsize=(8, 6))
plt.barh(top_features['feature'], top_features['importance'])
plt.xlabel('Importance')
plt.ylabel('Feature')
plt.title('Top 15 Feature Importance (Random Forest)')
plt.gca().invert_yaxis()
plt.show()

y_proba_deepLearning = model_deep_learning.predict(X_test_processed).ravel()
y_pred_deepLearning = (y_proba_deepLearning >= 0.3).astype(int)

report_dl = classification_report(y_test, y_pred_deepLearning, output_dict=True)
acc_dl = report_dl["accuracy"]
f1_dl = report_dl["1"]["f1-score"] # F1-score for class 1 (yes)
auc_dl = roc_auc_score(y_test, y_proba_deepLearning)

print(classification_report(y_test, y_pred_deepLearning))
print("ROC-AUC: ", auc_dl)

confMatrix_DeepLearning = confusion_matrix(y_test, y_pred_deepLearning)
sns.heatmap(confMatrix_DeepLearning, annot=True, fmt='d', cmap='Blues')
plt.title("Confusion Matrix")
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.show()